<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ | SchoolX</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <style>
        body{background:linear-gradient(135deg,#c9a552,#b48b33);font-family:Cairo;min-height:100vh;margin:0;display:flex;align-items:center;justify-content:center}
        .card{background:white;max-width:500px;width:90%;border-radius:25px;overflow:hidden;box-shadow:0 20px 40px rgba(0,0,0,.3);margin:20px}
        header{background:#b48b33;color:white;padding:25px;text-align:center}
        header h1{font-size:28px;margin:10px 0}
        .content{padding:30px;text-align:center}
        .question{font-size:22px;font-weight:bold;margin:20px 0;color:#333}
        .options{margin:30px 0}
        .option{background:#f8f9fa;border:3px solid #c9a552;border-radius:15px;padding:18px;margin:12px 0;font-size:19px;cursor:pointer;transition:.3s}
        .option:hover{background:#c9a552;color:white}
        .option.selected{background:#c9a552;color:white}
        #result{margin:20px 0;padding:20px;border-radius:15px;font-size:20px;font-weight:bold}
        .winner{color:#27ae60;background:#d5f4e6}
        .wrong{color:#e74c3c;background:#fadbd8}
        .winners-list{margin-top:30px;background:#f9f9f9;padding:20px;border-radius:15px}
        .winner-item{margin:10px 0;padding:10px;background:white;border-radius:10px}
        .back{position:fixed;bottom:20px;left:20px;background:#333;color:white;padding:15px;border-radius:50%;width:60px;height:60px;font-size:24px;text-align:center;line-height:30px}
    </style>
</head>
<body>

<div class="card">
    <header>
        <h1>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h1>
        <p>Ø£ÙˆÙ„ 5 ÙŠØ¬Ø§ÙˆØ¨ÙˆØ§ ØµØ­ = 50 Ù†Ù‚Ø·Ø© + Ø§Ø³Ù…Ù‡Ù… ÙÙŠ Ø¬Ø¯Ø§Ø± Ø§Ù„Ø´Ø±Ù!</p>
    </header>
    <div class="content">
        <div class="question" id="question">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„...</div>
        <div class="options" id="options"></div>
        <div id="result"></div>
        <div class="winners-list" id="winners"></div>
    </div>
</div>

<a href="index.html" class="back">Ø±Ø¬ÙˆØ¹</a>

<script>
    let selected = null;
    async function loadQuiz() {
        const res = await fetch('/api/weekly-quiz');
        const data = await res.json();
        
        document.getElementById('question').innerHTML = data.question;
        
        const opts = document.getElementById('options');
        opts.innerHTML = '';
        data.options.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = 'option';
            div.textContent = opt;
            div.onclick = () => {
                document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
                div.classList.add('selected');
                selected = i;
            };
            opts.appendChild(div);
        });

        const winnersDiv = document.getElementById('winners');
        if (data.winners.length > 0) {
            winnersDiv.innerHTML = `<h3>Ø§Ù„ÙØ§Ø¦Ø²Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ğŸ†</h3>`;
            data.winners.forEach(w => {
                winnersDiv.innerHTML += `<div class="winner-item"><strong>${w.rank}.</strong> ${w.fullName}</div>`;
            });
        }
    }

    document.querySelector('.card').onclick = async () => {
        if (selected === null) return alert("Ø§Ø®ØªØ§Ø±ÙŠ Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£ÙˆÙ„ ÙŠØ§ Ù‚Ù…Ø±!");

        const username = prompt("Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨ØªØ§Ø¹Ùƒ:");
        if (!username) return;

        const res = await fetch('/api/weekly-quiz/answer', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, answerIndex: selected })
        });
        const result = await res.json();

        const resultDiv = document.getElementById('result');
        if (result.result === "winner") {
            resultDiv.className = "winner";
            resultDiv.innerHTML = result.message + "<br>ğŸ‰ğŸ‰ğŸ‰";
            setTimeout(loadQuiz, 3000);
        } else if (result.result === "already_won") {
            resultDiv.innerHTML = "Ø¥Ù†ØªÙŠ ÙØ²ØªÙŠ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡â€¦ Ø´ÙƒØ±Ù‹Ø§ Ù„ÙŠÙƒÙŠ!";
        } else {
            resultDiv.className = "wrong";
            resultDiv.innerHTML = result.message;
        }
    };

    loadQuiz();
</script>
</body>
</html>
