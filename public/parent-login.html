<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุณุฌูู ุฏุฎูู ููู ุงูุฃูุฑ</title>
    <link rel="stylesheet" href="login.css"> <!-- ููุณ ููู login.css ุจุชุงุน signup.html -->
</head>
<body>
    <header class="main-header">
        <img src="logo.png" alt="ุดุนุงุฑ ุงููุนูุฏ" class="logo">
        <h1>ุชุณุฌูู ุฏุฎูู ููู ุงูุฃูุฑ</h1>
    </header>

    <div class="main-container">
        <div class="login-form-container">
            <h2>ูุฑุญุจุงู ุจู ูุง ููู ุงูุฃูุฑ ๐จโ๐ฉโ๐ง</h2>
            <p style="text-align:center;color:#94a3b8;margin-bottom:30px;">
                ุงุฏุฎู ุจูุงูุงุชู ุนุดุงู ุชุดูู ูุชุงูุฌ ูุชูุฏู ุงุจูู/ุจูุชู
            </p>
            <form id="parent-login-form">
                <div class="input-group">
                    <label for="parentName">ุงุณู ููู ุงูุฃูุฑ ุฑุจุงุนู</label>
                    <input type="text" id="parentName" placeholder="ูุซุงู: ูุญูุฏ ุนูู ุฃุญูุฏ ุงูุณูุฏ" required>
                </div>

                <div class="input-group">
                    <label for="parentId">ุฑูู ุจุทุงูุฉ ููู ุงูุฃูุฑ</label>
                    <input type="text" id="parentId" inputmode="numeric" maxlength="14" placeholder="14 ุฑูู ุจุงูุธุจุท" required>
                </div>

                <button type="submit" class="submit-btn">ุชุณุฌูู ุงูุฏุฎูู</button>

                <p style="text-align: center; margin-top: 20px;">
                    ุทุงูุจ ุฌุฏูุฏุ <a href="signup.html" class="signup-link">ุฅูุดุงุก ุญุณุงุจ ุทุงูุจ</a>
                </p>
            </form>
        </div>
    </div>

    <footer>
        <p>Developed by Ahmed Mousa <span class="heart">โค</span></p>
    </footer>

    <script>
        function showToast(message, type = 'error') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed; bottom: 20px; right: 20px; padding: 12px 24px; border-radius: 8px;
                color: white; font-weight: bold; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                background-color: ${type === 'success' ? '#28a745' : '#dc3545'};
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        document.getElementById('parent-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const parentName = document.getElementById('parentName').value.trim();
            const parentId = document.getElementById('parentId').value.replace(/\s/g, '');

            if (!parentName || !parentId) {
                showToast('ูุฑุฌู ููุก ุฌููุน ุงูุญููู!', 'error');
                return;
            }

            if (parentId.length !== 14 || !/^\d{14}$/.test(parentId)) {
                showToast('ุฑูู ุงูุจุทุงูุฉ ูุฌุจ ุฃู ูููู 14 ุฑูู ุจุงูุธุจุท!', 'error');
                return;
            }

            try {
                showToast('ุฌุงุฑู ุงูุจุญุซ ุนู ุญุณุงุจ ุงุจูู...', 'info');

                const response = await fetch('/api/students');
                if (!response.ok) throw new Error('ูุดู ูู ุฌูุจ ุงูุจูุงูุงุช');
                const students = await response.json();

                const student = students.find(s => 
                    s.profile && 
                    s.profile.parentName && s.profile.parentName.toLowerCase() === parentName.toLowerCase() &&
                    s.profile.parentId === parentId
                );

                if (!student) {
                    showToast('ูู ูุชู ุงูุนุซูุฑ ุนูู ุญุณุงุจ ูุฑุชุจุท ุจูุฐู ุงูุจูุงูุงุช!', 'error');
                    return;
                }

                // ุญูุธ ุจูุงูุงุช ุงูุทุงูุจ + ุนูุงูุฉ ุฅูู ููู ุฃูุฑ
                localStorage.setItem('currentUser', JSON.stringify({
                    username: student.username,
                    fullName: student.fullName,
                    role: 'parent',
                    studentId: student.id,
                    parentView: true
                }));

                showToast(`ูุฑุญุจุงู ${parentName}ุ ุฌุงุฑู ุชุญูููู ูุญุณุงุจ ุงุจูู...`, 'success');
                setTimeout(() => {
                    window.location.href = 'Home.html'; // ุฃู Home.html - ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
                }, 1500);

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุณุฌูู ุฏุฎูู ููู ุงูุฃูุฑ:', error);
                showToast('ุญุฏุซ ุฎุทุฃุ ุฌุฑุจ ุชุงูู!', 'error');
            }
        });
    </script>
</body>
</html>
